"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.compactPatches = void 0;
const lodash_1 = require("lodash");
/**
 * Try to compact a set of patches
 *
 */
function compactPatches(patches) {
    // If the last patch is unsetting everything, just do that
    const lastPatch = patches.slice(-1)[0];
    if (lastPatch && lastPatch.type === 'unset' && lastPatch.path.length === 0) {
        return [lastPatch];
    }
    let finalPatches = patches;
    // Run through the patches and remove any redundant ones.
    finalPatches = finalPatches.filter((patch, index) => {
        if (!patch) {
            return false;
        }
        const nextPatch = finalPatches[index + 1];
        if (nextPatch &&
            nextPatch.type === 'set' &&
            patch.type === 'set' &&
            lodash_1.isEqual(patch.path, nextPatch.path)) {
            return false;
        }
        return true;
    });
    if (finalPatches.length !== patches.length) {
        return finalPatches;
    }
    return patches;
}
exports.compactPatches = compactPatches;
//# sourceMappingURL=patches.js.map